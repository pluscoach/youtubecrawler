# ğŸš€ ì›¹ì‚¬ì´íŠ¸ ê°œë°œ ê°€ì´ë“œ

## ì´ ê°€ì´ë“œëŠ”?
YouTube Analyzer í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ë©´ì„œ ê²ªì€ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ì‘ì„±í•œ **ì‹¤ì „ ê°€ì´ë“œ**ì…ë‹ˆë‹¤.
ìƒˆë¡œìš´ ì›¹ì‚¬ì´íŠ¸ë¥¼ ë§Œë“¤ ë•Œ ì°¸ê³ í•˜ì„¸ìš”.

---

## ğŸ“‹ ì‘ì—… ìˆœì„œ (ê¶Œì¥)

### 1ë‹¨ê³„: ê¸°íš ë° ì„¤ê³„ (ë¨¼ì €!)
```
â–¡ ì„œë¹„ìŠ¤ ëª©ì  ì •ì˜ (ëˆ„ê°€, ì™œ ì“°ëŠ”ì§€)
â–¡ í•µì‹¬ ê¸°ëŠ¥ ëª©ë¡ ì‘ì„±
â–¡ ê¸°ìˆ  ìŠ¤íƒ ê²°ì •
â–¡ í´ë” êµ¬ì¡° ì„¤ê³„
â–¡ API ì„¤ê³„ (ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡)
â–¡ DB ìŠ¤í‚¤ë§ˆ ì„¤ê³„
```

### 2ë‹¨ê³„: ì™¸ë¶€ ì„œë¹„ìŠ¤ ì„¤ì • (API í‚¤ ë¨¼ì € í™•ë³´!)
```
â–¡ í•„ìš”í•œ ì™¸ë¶€ ì„œë¹„ìŠ¤ ëª©ë¡ ì‘ì„±
â–¡ ê° ì„œë¹„ìŠ¤ ê³„ì • ìƒì„± ë° API í‚¤ ë°œê¸‰
â–¡ API í‚¤ í…ŒìŠ¤íŠ¸ (ê°ê° ê°œë³„ë¡œ!)
â–¡ .env íŒŒì¼ì— í‚¤ ì •ë¦¬
```

### 3ë‹¨ê³„: ë°±ì—”ë“œ ê°œë°œ
```
â–¡ í”„ë¡œì íŠ¸ í´ë” ìƒì„±
â–¡ ê¸°ë³¸ ì„œë²„ ì‹¤í–‰ í™•ì¸
â–¡ DB ì—°ê²° í…ŒìŠ¤íŠ¸
â–¡ API ì—”ë“œí¬ì¸íŠ¸ í•˜ë‚˜ì”© êµ¬í˜„ ë° í…ŒìŠ¤íŠ¸
```

### 4ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ
```
â–¡ ê¸°ë³¸ í˜ì´ì§€ ë ˆì´ì•„ì›ƒ
â–¡ API ì—°ë™
â–¡ ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œë”© ìƒíƒœ
â–¡ UI/UX ë‹¤ë“¬ê¸°
```

### 5ë‹¨ê³„: í†µí•© í…ŒìŠ¤íŠ¸ ë° ë°°í¬
```
â–¡ ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
â–¡ ì—ëŸ¬ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸
â–¡ ë°°í¬ (Vercel, Railway ë“±)
â–¡ í”„ë¡œë•ì…˜ í™˜ê²½ í…ŒìŠ¤íŠ¸
```

---

## ğŸ”‘ API í‚¤ ê´€ë¦¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°œê¸‰ ì‹œ í™•ì¸ì‚¬í•­
| ì„œë¹„ìŠ¤ | í•„ìš”í•œ í‚¤ | í˜•ì‹ ì˜ˆì‹œ |
|--------|----------|----------|
| **Anthropic** | API Key | `sk-ant-api03-xxx...` |
| **YouTube** | Data API Key | `AIzaSy...` |
| **Supabase** | URL + service_role Key | `https://xxx.supabase.co` + `eyJhbG...` (JWT) |
| **OpenAI** | API Key | `sk-xxx...` |
| **Stripe** | Secret Key | `sk_live_xxx...` ë˜ëŠ” `sk_test_xxx...` |

### âš ï¸ Supabase í‚¤ ì£¼ì˜ì‚¬í•­ (ì¤‘ìš”!)
```
âŒ ì˜ëª»ëœ í‚¤: sb_publishable_xxx (í”„ë¡ íŠ¸ì—”ë“œìš©)
âŒ ì˜ëª»ëœ í‚¤: sb_secret_xxx (ìƒˆ í˜•ì‹, í˜¸í™˜ ì•ˆ ë  ìˆ˜ ìˆìŒ)
âœ… ì˜¬ë°”ë¥¸ í‚¤: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... (Legacy service_role)

ì°¾ëŠ” ë°©ë²•:
Settings â†’ API Keys â†’ "Legacy anon, service_role API keys" íƒ­ â†’ service_role ë³µì‚¬
```

### API í‚¤ ê°œë³„ í…ŒìŠ¤íŠ¸ ë°©ë²•

**Anthropic:**
```python
python -c "
import anthropic
client = anthropic.Anthropic(api_key='ë„ˆì˜_í‚¤')
response = client.messages.create(
    model='claude-sonnet-4-20250514',
    max_tokens=100,
    messages=[{'role': 'user', 'content': 'Hello'}]
)
print('ì„±ê³µ:', response.content[0].text)
"
```

**Supabase:**
```python
python -c "
from supabase import create_client
client = create_client('ë„ˆì˜_URL', 'ë„ˆì˜_service_role_í‚¤')
print('ì—°ê²° ì„±ê³µ')
result = client.table('í…Œì´ë¸”ëª…').select('*').limit(1).execute()
print(result)
"
```

**YouTube:**
```bash
curl "https://www.googleapis.com/youtube/v3/videos?part=snippet&id=dQw4w9WgXcQ&key=ë„ˆì˜_í‚¤"
```

---

## ğŸ› ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œì™€ í•´ê²°ë²•

### 1. "Invalid API key" ì—ëŸ¬

**ì›ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸:**
```
â–¡ .env íŒŒì¼ì— í‚¤ê°€ ì œëŒ€ë¡œ ë“¤ì–´ê°”ëŠ”ì§€ í™•ì¸
â–¡ í‚¤ ì•ë’¤ì— ê³µë°±ì´ë‚˜ ë”°ì˜´í‘œê°€ ì—†ëŠ”ì§€ í™•ì¸
â–¡ í‚¤ê°€ í•œ ì¤„ë¡œ ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ (ì¤„ë°”ê¿ˆ X)
â–¡ ì˜¬ë°”ë¥¸ í‚¤ ì¢…ë¥˜ì¸ì§€ í™•ì¸ (public vs secret)
â–¡ ì„œë²„ ì¬ì‹œì‘í–ˆëŠ”ì§€ í™•ì¸ (@lru_cache ìºì‹± ë¬¸ì œ)
```

**í•´ê²° ë‹¨ê³„:**
```
1. í„°ë¯¸ë„ì—ì„œ ì§ì ‘ API í…ŒìŠ¤íŠ¸ (ìœ„ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‚¬ìš©)
2. ì„±ê³µí•˜ë©´ â†’ ì½”ë“œê°€ í‚¤ë¥¼ ëª» ì½ì–´ì˜¤ëŠ” ë¬¸ì œ
3. ì‹¤íŒ¨í•˜ë©´ â†’ í‚¤ ìì²´ê°€ ì˜ëª»ë¨, ì¬ë°œê¸‰ í•„ìš”
```

### 2. "Object of type X is not JSON serializable" ì—ëŸ¬

**ì›ì¸:** 
- ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë°˜í™˜í•œ ê°ì²´ë¥¼ ì§ì ‘ JSONìœ¼ë¡œ ë³€í™˜í•˜ë ¤ê³  í•  ë•Œ

**í•´ê²°:**
```python
# âŒ ì˜ëª»ëœ ë°©ë²•
return transcript_data  # ê°ì²´ ê·¸ëŒ€ë¡œ ë°˜í™˜

# âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
return ' '.join([item.text for item in transcript_data])  # ë¬¸ìì—´ë¡œ ë³€í™˜
```

### 3. ìë§‰ ì¶”ì¶œ ì—ëŸ¬ (YouTube)

**"No transcripts were found for language codes: ('en',)"**
```python
# âŒ ì˜ì–´ë§Œ ì°¾ìŒ
transcript = YouTubeTranscriptApi.get_transcript(video_id, languages=['en'])

# âœ… í•œêµ­ì–´ ìš°ì„ , ì—†ìœ¼ë©´ ì˜ì–´
transcript = YouTubeTranscriptApi.get_transcript(video_id, languages=['ko', 'en'])
```

### 4. CORS ì—ëŸ¬

**ì¦ìƒ:** í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë°±ì—”ë“œ API í˜¸ì¶œ ì‹œ ì—ëŸ¬

**í•´ê²° (FastAPI):**
```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],  # í”„ë¡ íŠ¸ì—”ë“œ ì£¼ì†Œ
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### 5. í™˜ê²½ë³€ìˆ˜ ìºì‹± ë¬¸ì œ

**ì¦ìƒ:** .env ìˆ˜ì •í–ˆëŠ”ë° ì ìš© ì•ˆ ë¨

**ì›ì¸:** Pythonì˜ `@lru_cache()` ë°ì½”ë ˆì´í„°

**í•´ê²°:**
```bash
# 1. ìºì‹œ í´ë” ì‚­ì œ
rm -rf __pycache__
rm -rf app/__pycache__
rm -rf app/services/__pycache__

# 2. ì„œë²„ ì™„ì „íˆ ì¢…ë£Œ í›„ ì¬ì‹œì‘
# Ctrl+Cë¡œ ì¢…ë£Œ
uvicorn app.main:app --reload
```

### 6. ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²„ì „ ì¶©ëŒ

**ì¦ìƒ:** `HTTPTransport.__init__() got an unexpected keyword argument`

**í•´ê²°:**
```bash
pip install httpx==0.27.0 anthropic==0.18.1 --force-reinstall
```

### 7. DNS/URL ì—ëŸ¬

**ì¦ìƒ:** `getaddrinfo failed`

**ì›ì¸:** URL ì˜¤íƒ€

**í•´ê²°:**
```
1. ì™¸ë¶€ ì„œë¹„ìŠ¤ ëŒ€ì‹œë³´ë“œì—ì„œ ì •í™•í•œ URL ë³µì‚¬
2. .env íŒŒì¼ê³¼ ë¹„êµ
3. ê¸€ì í•˜ë‚˜í•˜ë‚˜ í™•ì¸ (íŠ¹íˆ ë¹„ìŠ·í•œ ê¸€ì: l/1, o/0, q/g)
```

### 8. í”„ë¡ íŠ¸ì—”ë“œ-ë°±ì—”ë“œ í¬íŠ¸ ë¶ˆì¼ì¹˜

**ì¦ìƒ:** í”„ë¡ íŠ¸ì—”ë“œì—ì„œ API í˜¸ì¶œ ì‹œ ì—°ê²° ì‹¤íŒ¨

**ì›ì¸:** í”„ë¡ íŠ¸ì—”ë“œì˜ API URLê³¼ ì‹¤ì œ ë°±ì—”ë“œ ì„œë²„ í¬íŠ¸ê°€ ë‹¤ë¦„

**í•´ê²°:**
```
1. ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ í¬íŠ¸ í™•ì¸ (ì˜ˆ: 8000)
2. í”„ë¡ íŠ¸ì—”ë“œ API ì„¤ì • íŒŒì¼ í™•ì¸
   - íŒŒì¼: frontend/src/lib/api.ts
   - í™•ì¸í•  ë¶€ë¶„: const API_URL = ... 'http://localhost:XXXX'
3. í¬íŠ¸ ë²ˆí˜¸ ì¼ì¹˜ì‹œí‚¤ê¸°
```

**ì˜ˆì‹œ (2025.01.07 ë°œìƒ):**
```typescript
// âŒ ì˜ëª»ë¨ - ë°±ì—”ë“œê°€ 8000ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ë° 8001ë¡œ ì„¤ì •
const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8001';

// âœ… ì˜¬ë°”ë¦„
const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';
```

### 9. TypeScript ì£¼ì„ê³¼ ì½”ë“œê°€ ê°™ì€ ì¤„ì— ë¶™ì–´ìˆëŠ” ë¬¸ë²• ì˜¤ë¥˜

**ì¦ìƒ:** `Failed to compile` - `Expression expected` Syntax Error

**ì›ì¸:** í•œê¸€ ì£¼ì„ì´ ê¹¨ì§€ë©´ì„œ ì£¼ì„ê³¼ export/ì½”ë“œê°€ ê°™ì€ ì¤„ì— ë¶™ì–´ë²„ë¦¼

**í•´ê²°:**
```
1. ì˜¤ë¥˜ ë©”ì‹œì§€ì—ì„œ íŒŒì¼ëª…ê³¼ ì¤„ ë²ˆí˜¸ í™•ì¸
2. í•´ë‹¹ ì¤„ì—ì„œ ì£¼ì„(//)ê³¼ ì½”ë“œê°€ ê°™ì€ ì¤„ì— ìˆëŠ”ì§€ í™•ì¸
3. ì£¼ì„ê³¼ ì½”ë“œ ì‚¬ì´ì— ì¤„ë°”ê¿ˆ ì¶”ê°€
```

**ì˜ˆì‹œ (2025.01.07 ë°œìƒ):**
```typescript
// âŒ ì˜ëª»ë¨ - ì£¼ì„ê³¼ exportê°€ ê°™ì€ ì¤„ì— ë¶™ì–´ìˆìŒ
// B-roll ?ï¿½ì›Œ??export interface BRollKeyword {

// âœ… ì˜¬ë°”ë¦„ - ì¤„ë°”ê¿ˆìœ¼ë¡œ ë¶„ë¦¬
// B-roll í‚¤ì›Œë“œ
export interface BRollKeyword {
```

**ì´ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê¸° ì‰¬ìš´ ìƒí™©:**
- íŒŒì¼ ì¸ì½”ë”© ë¬¸ì œë¡œ í•œê¸€ ì£¼ì„ì´ ê¹¨ì§ˆ ë•Œ
- Git merge ê³¼ì •ì—ì„œ ì¶©ëŒ í•´ê²° ì‹œ
- ë³µì‚¬/ë¶™ì—¬ë„£ê¸° ê³¼ì •ì—ì„œ ì¤„ë°”ê¿ˆì´ ì‚¬ë¼ì§ˆ ë•Œ

**ë°œìƒ íŒŒì¼:** `frontend/src/lib/api.ts` (ì—¬ëŸ¬ ì¸í„°í˜ì´ìŠ¤ ì •ì˜ ë¶€ë¶„)

### 10. youtube-transcript-api ë¼ì´ë¸ŒëŸ¬ë¦¬ API ë³€ê²½

**ì¦ìƒ:** ìë§‰ ì¶”ì¶œ ì‹œ `AttributeError` ë˜ëŠ” ê¸°ì¡´ ë©”ì„œë“œê°€ ë™ì‘ ì•ˆ í•¨

**ì›ì¸:** youtube-transcript-api ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì—…ë°ì´íŠ¸ë˜ë©´ì„œ API ì‚¬ìš© ë°©ì‹ì´ ë³€ê²½ë¨

**í•´ê²°:**
```python
# âŒ êµ¬ë²„ì „ ë°©ì‹ (ë™ì‘ ì•ˆ í•¨)
from youtube_transcript_api import YouTubeTranscriptApi
transcript = YouTubeTranscriptApi.get_transcript(video_id, languages=['ko', 'en'])

# âœ… ì‹ ë²„ì „ ë°©ì‹ (ì¸ìŠ¤í„´ìŠ¤ ìƒì„± í•„ìš”)
from youtube_transcript_api import YouTubeTranscriptApi
api = YouTubeTranscriptApi()
transcript_list = api.list(video_id)  # ìë§‰ ëª©ë¡ ì¡°íšŒ
transcript_data = transcript.fetch()   # íŠ¹ì • ìë§‰ ê°€ì ¸ì˜¤ê¸°
```

**ë°œìƒ íŒŒì¼:** `backend/app/services/transcript.py`

### 11. ìë§‰ ì–¸ì–´ ìš°ì„ ìˆœìœ„ ë° í´ë°± ì²˜ë¦¬

**ì¦ìƒ:** íŠ¹ì • ì˜ìƒì—ì„œ "ìë§‰ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" ì—ëŸ¬

**ì›ì¸:** í•œêµ­ì–´/ì˜ì–´ ìë§‰ì´ ì—†ê±°ë‚˜, ìë™ìƒì„± ìë§‰ë§Œ ìˆëŠ” ê²½ìš° ì²˜ë¦¬ ì•ˆ ë¨

**í•´ê²°:**
```python
# ìë§‰ ìš°ì„ ìˆœìœ„ í´ë°± ë¡œì§
# 1. í•œêµ­ì–´ ìˆ˜ë™ ìë§‰
# 2. í•œêµ­ì–´ ìë™ìƒì„± ìë§‰
# 3. ì˜ì–´ ìˆ˜ë™ ìë§‰
# 4. ì˜ì–´ ìë™ìƒì„± ìë§‰
# 5. ì•„ë¬´ ìë§‰ì´ë‚˜ (ë§ˆì§€ë§‰ í´ë°±)

for transcript in transcripts:
    if transcript.language_code == 'ko' and not transcript.is_generated:
        target_transcript = transcript
        break
# ... ì´í›„ í´ë°± ë¡œì§ ê³„ì†
```

**í•µì‹¬:** `is_generated` ì†ì„±ìœ¼ë¡œ ìˆ˜ë™/ìë™ ìë§‰ êµ¬ë¶„ ê°€ëŠ¥

**ë°œìƒ íŒŒì¼:** `backend/app/services/transcript.py`

### 12. í™˜ê²½ë³€ìˆ˜ ë¡œë”© íƒ€ì´ë° ë¬¸ì œ (Supabase ë“±)

**ì¦ìƒ:** í™˜ê²½ë³€ìˆ˜ê°€ Noneìœ¼ë¡œ ì½íˆê±°ë‚˜, "URL and Key must be set" ì—ëŸ¬

**ì›ì¸:** ëª¨ë“ˆ ë¡œë“œ ì‹œì ì— `get_settings()`ë¥¼ ì „ì—­ì—ì„œ í˜¸ì¶œí•˜ë©´ í™˜ê²½ë³€ìˆ˜ê°€ ì•„ì§ ë¡œë“œ ì•ˆ ë¨

**í•´ê²°:**
```python
# âŒ ì˜ëª»ë¨ - ëª¨ë“ˆ ë¡œë“œ ì‹œì ì— í˜¸ì¶œ
settings = get_settings()  # ì „ì—­ ë³€ìˆ˜

def get_supabase():
    if not settings.supabase_url:  # ì´ë¯¸ Noneìœ¼ë¡œ ê³ ì •ë¨
        raise ValueError(...)

# âœ… ì˜¬ë°”ë¦„ - í•¨ìˆ˜ í˜¸ì¶œ ì‹œì ì— ë¡œë“œ
def get_supabase():
    settings = get_settings()  # í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ í˜¸ì¶œ
    if not settings.supabase_url:
        raise ValueError(...)
```

**ë°œìƒ íŒŒì¼:** `backend/app/database.py`

### 13. requirements.txt ë²„ì „ ì¶©ëŒ

**ì¦ìƒ:** `pip install` ì‹œ ì˜ì¡´ì„± ì¶©ëŒ, ë˜ëŠ” ëŸ°íƒ€ì„ì— `unexpected keyword argument` ì—ëŸ¬

**ì›ì¸:** ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°„ ë²„ì „ í˜¸í™˜ì„± ë¬¸ì œ (ì˜ˆ: httpx, anthropic)

**í•´ê²°:**
```
# âŒ ê³ ì • ë²„ì „ (ì¶©ëŒ ê°€ëŠ¥)
httpx==0.24.0
anthropic==0.18.1

# âœ… ìœ ì—°í•œ ë²„ì „ ë²”ìœ„
httpx>=0.27.0
anthropic>=0.18.1
```

**ì¶”ê°€ í•´ê²°ë²•:**
```bash
# ê°•ì œ ì¬ì„¤ì¹˜
pip install httpx==0.27.0 anthropic==0.18.1 --force-reinstall
```

**ë°œìƒ íŒŒì¼:** `backend/requirements.txt`

### 14. ë””ë²„ê·¸ printë¬¸ ì •ë¦¬

**ì¦ìƒ:** ì½˜ì†”ì— ë¶ˆí•„ìš”í•œ DEBUG ë©”ì‹œì§€ ì¶œë ¥, í”„ë¡œë•ì…˜ ë¡œê·¸ ì˜¤ì—¼

**ì›ì¸:** íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ì¤‘ ì¶”ê°€í•œ printë¬¸ì„ ì œê±° ì•ˆ í•¨

**í•´ê²°:**
```python
# âŒ ì œê±°í•´ì•¼ í•  ì½”ë“œ
print(f"[DEBUG] API ì‘ë‹µ: {response}")
print(f"[DEBUG] ì„¤ì •ê°’: {settings}")

# âœ… í•„ìš”í•˜ë©´ logging ëª¨ë“ˆ ì‚¬ìš©
import logging
logger = logging.getLogger(__name__)
logger.debug(f"API ì‘ë‹µ: {response}")  # í”„ë¡œë•ì…˜ì—ì„œëŠ” ì¶œë ¥ ì•ˆ ë¨
```

**ì²´í¬í•  íŒŒì¼ë“¤:**
- `backend/app/services/transcript.py`
- `backend/app/services/claude.py`
- `backend/app/routers/youtube.py`
- `backend/app/config.py`
- `backend/app/database.py`

### 15. Claude API ëª¨ë¸ë³„ max_tokens ì œí•œ (2025.01.07 ë°œìƒ)

**ì¦ìƒ:** `max_tokens: 8192 > 4096, which is the maximum allowed number of output tokens for claude-3-5-haiku`

**ì›ì¸:** Claude ëª¨ë¸ë³„ë¡œ ìµœëŒ€ ì¶œë ¥ í† í° ì œí•œì´ ë‹¤ë¦„
- Haiku: ìµœëŒ€ 4096 í† í°
- Sonnet: ìµœëŒ€ 8192 í† í°

**í•´ê²°:**
```python
# âŒ ì˜ëª»ë¨ - Haikuì— 8192 ì„¤ì •
response = client.messages.create(
    model="claude-3-5-haiku-20241022",
    max_tokens=8192,  # HaikuëŠ” 4096ê¹Œì§€ë§Œ!
    ...
)

# âœ… ì˜¬ë°”ë¦„ - ëª¨ë¸ì— ë§ëŠ” í† í° ìˆ˜ ì„¤ì •
response = client.messages.create(
    model="claude-3-5-haiku-20241022",
    max_tokens=4096,  # Haiku ìµœëŒ€ê°’
    ...
)
```

**ë°œìƒ íŒŒì¼:** `backend/app/services/claude.py`

### 16. Pydantic Settings "Extra inputs are not permitted" ì—ëŸ¬ (2025.01.07 ë°œìƒ)

**ì¦ìƒ:** `pydantic_core._pydantic_core.ValidationError: Extra inputs are not permitted`

**ì›ì¸:** .env íŒŒì¼ì— ìƒˆ í™˜ê²½ë³€ìˆ˜ë¥¼ ì¶”ê°€í–ˆëŠ”ë°, config.pyì˜ Settings í´ë˜ìŠ¤ì— í•´ë‹¹ í•„ë“œë¥¼ ì •ì˜ ì•ˆ í•¨

**í•´ê²°:**
```python
# .env íŒŒì¼ì— ì¶”ê°€í•œ ê²½ìš°:
# TAVILY_API_KEY=tvly-xxx...

# âŒ ì˜ëª»ë¨ - config.pyì— í•„ë“œ ì—†ìŒ
class Settings(BaseSettings):
    anthropic_api_key: str = ""
    # tavily_api_key ì—†ìŒ!

# âœ… ì˜¬ë°”ë¦„ - í•„ë“œ ì¶”ê°€
class Settings(BaseSettings):
    anthropic_api_key: str = ""
    tavily_api_key: str = ""  # ì¶”ê°€!
```

**ë°œìƒ íŒŒì¼:** `backend/app/config.py`

### 17. ìƒˆ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ ì‹œ ì˜ì¡´ì„± ë¹Œë“œ ì‹¤íŒ¨ (2025.01.07 ë°œìƒ)

**ì¦ìƒ:** `pip install` ì‹œ `error: can't find Rust compiler` ë˜ëŠ” wheel ë¹Œë“œ ì‹¤íŒ¨

**ì›ì¸:** ì¼ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬(ì˜ˆ: tiktoken)ê°€ Rust ì»´íŒŒì¼ëŸ¬ë‚˜ íŠ¹ì • ë¹Œë“œ ë„êµ¬ í•„ìš”

**í•´ê²°:**
```bash
# ë°©ë²• 1: pip ì—…ê·¸ë ˆì´ë“œ í›„ pre-built wheelë§Œ ì„¤ì¹˜
python.exe -m pip install --upgrade pip
pip install íŒ¨í‚¤ì§€ëª… --only-binary :all:

# ë°©ë²• 2: êµ¬ë²„ì „ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© (ì˜ì¡´ì„± ì—†ëŠ” ë²„ì „)
# ì˜ˆ: tavily-python ìµœì‹  ë²„ì „ì€ tiktoken í•„ìš” â†’ êµ¬ë²„ì „ì€ ë¶ˆí•„ìš”
pip install tavily-python==0.1.9

# ë°©ë²• 3: ì½”ë“œì—ì„œ ë²„ì „ í˜¸í™˜ì„± ì²˜ë¦¬
try:
    from tavily import TavilyClient  # ì‹ ë²„ì „
except ImportError:
    from tavily import Client as TavilyClient  # êµ¬ë²„ì „
```

**ë°œìƒ íŒŒì¼:** `backend/app/services/tavily_search.py`

### 18. Next.js ìºì‹œ ì†ìƒ - "Cannot find module './719.js'" (2025.01.09 ë°œìƒ)

**ì¦ìƒ:**
```
Server Error
Error: Cannot find module './719.js'
Require stack:
- C:\...\frontend\.next\server\webpack-runtime.js
- C:\...\frontend\.next\server\pages\_document.js
```

**ì›ì¸:**
- Next.jsì˜ `.next` ë¹Œë“œ ìºì‹œê°€ ì†ìƒë¨
- ì½”ë“œ ë³€ê²½ ì¤‘ ë¹Œë“œ íŒŒì¼ ì¶©ëŒ
- ì´ì „ ë¹Œë“œ íŒŒì¼ê³¼ ìƒˆ ì½”ë“œê°€ ë¶ˆì¼ì¹˜

**í•´ê²°:**
```bash
# 1. í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ ì¢…ë£Œ (Ctrl+C ë˜ëŠ” í”„ë¡œì„¸ìŠ¤ kill)

# 2. .next í´ë” ì‚­ì œ
cd frontend
rm -rf .next

# 3. ì„œë²„ ì¬ì‹œì‘
npm run dev
```

**PowerShellë¡œ í”„ë¡œì„¸ìŠ¤ ê°•ì œ ì¢…ë£Œ:**
```powershell
# í¬íŠ¸ ì‚¬ìš© ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ í™•ì¸
netstat -ano | findstr :3000

# í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ (PIDë¡œ)
Stop-Process -Id <PID> -Force
```

**ì˜ˆë°©ë²•:**
- ì½”ë“œ ìˆ˜ì • í›„ ë¹Œë“œ ì—ëŸ¬ê°€ ë‚˜ë©´ `.next` í´ë” ì‚­ì œ í›„ ì¬ì‹œì‘
- ì—¬ëŸ¬ í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‹œì— ì‹¤í–‰ë˜ì§€ ì•Šë„ë¡ ì£¼ì˜

**ë°œìƒ íŒŒì¼:** `frontend/.next/` ìºì‹œ í´ë”

---

### 19. í¬íŠ¸ ì¶©ëŒ - "Address already in use" (2025.01.07 ë°œìƒ)

**ì¦ìƒ:** ì„œë²„ ì‹œì‘ ì‹œ `address already in use` ë˜ëŠ” ë‹¤ë¥¸ í¬íŠ¸ì—ì„œ ì‹¤í–‰ë¨

**ì›ì¸:** ì´ì „ í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œë˜ì§€ ì•Šê³  í¬íŠ¸ë¥¼ ì ìœ  ì¤‘

**í•´ê²°:**
```bash
# 1. í¬íŠ¸ ì‚¬ìš© ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ í™•ì¸
netstat -ano | findstr :3000  # ë˜ëŠ” :8000

# ê²°ê³¼ ì˜ˆì‹œ:
# TCP    0.0.0.0:3000    0.0.0.0:0    LISTENING    12345

# 2. í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ (PowerShell ì‚¬ìš©)
powershell -Command "Stop-Process -Id 12345 -Force"

# 3. ì„œë²„ ì¬ì‹œì‘
```

**ì£¼ì˜:** Windowsì˜ bash í™˜ê²½ì—ì„œëŠ” `taskkill /F /PID` ëª…ë ¹ì´ ì œëŒ€ë¡œ ë™ì‘ ì•ˆ í•  ìˆ˜ ìˆìŒ. PowerShell ì‚¬ìš© ê¶Œì¥.

### 19. ì™¸ë¶€ API ì—°ë™ ì‹œ ì¶œì²˜ ê²€ì¦ êµ¬ì¡° (2025.01.07 ì¶”ê°€)

**ëª©ì :** Claudeê°€ ë¶„ì„í•œ ì¶œì²˜ë¥¼ ì‹¤ì œ URLë¡œ ê²€ì¦

**êµ¬í˜„ íë¦„:**
```
1. Claude ë¶„ì„ â†’ source_trackingì— ì¶œì²˜ëª…ë§Œ í¬í•¨
2. verify_sources() í˜¸ì¶œ â†’ Tavily APIë¡œ ì‹¤ì œ URL ê²€ìƒ‰
3. ê²€ìƒ‰ ì„±ê³µ â†’ source_url ì¶”ê°€ + verified=True
4. ê²€ìƒ‰ ì‹¤íŒ¨ â†’ Google ê²€ìƒ‰ ë§í¬ë¡œ ëŒ€ì²´ + verified=False
```

**í•µì‹¬ ì½”ë“œ (youtube.py):**
```python
# 1ë‹¨ê³„ ë¶„ì„ í›„
analysis, error = await analyze_transcript(transcript)
analysis = await verify_sources(analysis)  # ì¶œì²˜ ê²€ì¦ ì¶”ê°€

# 2ë‹¨ê³„ ë¹„íŒì  ë¶„ì„ í›„
critical_result, error = await analyze_critical_v2(...)
critical_result = await verify_critical_sources(critical_result)
```

**í•„ìš” íŒŒì¼:**
- `backend/app/services/tavily_search.py` - Tavily API í´ë¼ì´ì–¸íŠ¸
- `backend/app/services/claude.py` - verify_sources(), verify_critical_sources()
- `backend/app/routers/youtube.py` - ê²€ì¦ ë‹¨ê³„ í˜¸ì¶œ

---

## ğŸ“ ê¶Œì¥ í´ë” êµ¬ì¡°

```
í”„ë¡œì íŠ¸ëª…/
â”œâ”€â”€ frontend/                # Next.js í”„ë¡ íŠ¸ì—”ë“œ
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/            # í˜ì´ì§€ë“¤
â”‚   â”‚   â”œâ”€â”€ components/     # ì»´í¬ë„ŒíŠ¸ë“¤
â”‚   â”‚   â””â”€â”€ lib/            # ìœ í‹¸ë¦¬í‹° (API í˜¸ì¶œ ë“±)
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ .env.local          # í”„ë¡ íŠ¸ì—”ë“œ í™˜ê²½ë³€ìˆ˜
â”‚
â”œâ”€â”€ backend/                 # FastAPI ë°±ì—”ë“œ
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py         # ì•± ì´ˆê¸°í™”
â”‚   â”‚   â”œâ”€â”€ config.py       # ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ database.py     # DB ì—°ê²°
â”‚   â”‚   â”œâ”€â”€ routers/        # API ë¼ìš°í„°ë“¤
â”‚   â”‚   â”œâ”€â”€ services/       # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”‚   â””â”€â”€ models/         # ë°ì´í„° ëª¨ë¸
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ .env                # ë°±ì—”ë“œ í™˜ê²½ë³€ìˆ˜
â”‚   â””â”€â”€ Dockerfile
â”‚
â”œâ”€â”€ plans/                   # ë¬¸ì„œ
â”‚   â”œâ”€â”€ CLAUDE.md           # í”„ë¡œì íŠ¸ ê°œìš”
â”‚   â”œâ”€â”€ ARCHITECTURE.md     # ì‹œìŠ¤í…œ êµ¬ì¡°
â”‚   â””â”€â”€ PROGRESS.md         # ì§„í–‰ ìƒí™©
â”‚
â”œâ”€â”€ .gitignore
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md
```

---

## ğŸ”§ ë””ë²„ê¹… íŒ

### 1. ë‹¨ê³„ë³„ë¡œ í™•ì¸í•˜ê¸°
```
ë¬¸ì œê°€ ìƒê¸°ë©´ ì „ì²´ íë¦„ì„ ë‹¨ê³„ë³„ë¡œ ë‚˜ëˆ ì„œ í™•ì¸:

1ë‹¨ê³„: ì…ë ¥ì´ ì œëŒ€ë¡œ ë“¤ì–´ì˜¤ëŠ”ì§€?
2ë‹¨ê³„: ì™¸ë¶€ API í˜¸ì¶œì´ ì„±ê³µí•˜ëŠ”ì§€?
3ë‹¨ê³„: ë°ì´í„° ë³€í™˜ì´ ì œëŒ€ë¡œ ë˜ëŠ”ì§€?
4ë‹¨ê³„: DB ì €ì¥ì´ ì„±ê³µí•˜ëŠ”ì§€?
5ë‹¨ê³„: ì‘ë‹µì´ í”„ë¡ íŠ¸ì—”ë“œì— ì œëŒ€ë¡œ ì „ë‹¬ë˜ëŠ”ì§€?
```

### 2. ë””ë²„ê·¸ ë¡œê·¸ ì¶”ê°€í•˜ê¸°
```python
print(f"[DEBUG] 1. ì…ë ¥ê°’: {input_data}")
print(f"[DEBUG] 2. API ì‘ë‹µ: {response[:100]}...")
print(f"[DEBUG] 3. ë³€í™˜ ê²°ê³¼: {type(result)}")
```

### 3. ì—ëŸ¬ ë©”ì‹œì§€ ì •í™•íˆ ì½ê¸°
```
ì—ëŸ¬ ë©”ì‹œì§€ê°€ ì–´ë””ì„œ ë°œìƒí–ˆëŠ”ì§€ í™•ì¸:
- í”„ë¡ íŠ¸ì—”ë“œ? ë°±ì—”ë“œ? ì™¸ë¶€ API?
- ì–´ë–¤ í•¨ìˆ˜/íŒŒì¼ì—ì„œ?
- ì •í™•í•œ ì—ëŸ¬ íƒ€ì…ì€?
```

---

## âœ… ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

```
â–¡ ëª¨ë“  API í‚¤ê°€ í”„ë¡œë•ì…˜ìš©ì¸ì§€ í™•ì¸
â–¡ .env íŒŒì¼ì´ .gitignoreì— ìˆëŠ”ì§€ í™•ì¸
â–¡ ë””ë²„ê·¸ ì½”ë“œ/printë¬¸ ì œê±°
â–¡ ì—ëŸ¬ í•¸ë“¤ë§ì´ ì œëŒ€ë¡œ ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
â–¡ í™˜ê²½ë³€ìˆ˜ê°€ ë°°í¬ í”Œë«í¼ì— ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
â–¡ CORS ì„¤ì •ì´ í”„ë¡œë•ì…˜ ë„ë©”ì¸ìœ¼ë¡œ ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
```

---

## ğŸ“š ì°¸ê³  ë§í¬

- [FastAPI ê³µì‹ ë¬¸ì„œ](https://fastapi.tiangolo.com/)
- [Next.js ê³µì‹ ë¬¸ì„œ](https://nextjs.org/docs)
- [Supabase ê³µì‹ ë¬¸ì„œ](https://supabase.com/docs)
- [Anthropic API ë¬¸ì„œ](https://docs.anthropic.com/)
- [Vercel ë°°í¬ ê°€ì´ë“œ](https://vercel.com/docs)
- [Railway ë°°í¬ ê°€ì´ë“œ](https://docs.railway.app/)

---

## ğŸ’¡ ë§ˆì§€ë§‰ íŒ

1. **API í‚¤ëŠ” í•­ìƒ ê°œë³„ í…ŒìŠ¤íŠ¸** - í†µí•©í•˜ê¸° ì „ì— ê°ê° ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
2. **ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì •í™•íˆ ì½ê¸°** - ì–´ë””ì„œ ë°œìƒí–ˆëŠ”ì§€ê°€ í•µì‹¬
3. **ìºì‹œ ë¬¸ì œ ì˜ì‹¬í•˜ê¸°** - ì•ˆ ë˜ë©´ ìºì‹œ ì‚­ì œ + ì„œë²„ ì¬ì‹œì‘
4. **í•œ ë²ˆì— í•˜ë‚˜ì”©** - ì—¬ëŸ¬ ê°œ ë™ì‹œì— ë°”ê¾¸ë©´ ë­ê°€ ë¬¸ì œì¸ì§€ ëª¨ë¦„
5. **ë¬¸ì„œí™”í•˜ê¸°** - í•´ê²°í•œ ë¬¸ì œëŠ” ê¸°ë¡í•´ë‘ê¸°

---

## ğŸ”¥ ë³µì¡í•œ ë¬¸ì œ í•´ê²° ì¼€ì´ìŠ¤ ìŠ¤í„°ë””

### Case 1: ì¶œì²˜ ë§í¬ê°€ ì „ë¶€ Google ê²€ìƒ‰ìœ¼ë¡œ ì—°ê²°ë˜ëŠ” ë¬¸ì œ (2025.01.07)

#### ğŸ“‹ ì¦ìƒ
- ë¹„íŒì  ë¶„ì„ ê²°ê³¼ì˜ "ìˆ¨ê²¨ì§„ ì „ì œ", "í˜„ì‹¤ì  ëª¨ìˆœ" ë“± ëª¨ë“  ì¶œì²˜ ë§í¬ê°€ ğŸ” ì•„ì´ì½˜ê³¼ í•¨ê»˜ Google ê²€ìƒ‰ìœ¼ë¡œ ì—°ê²°ë¨
- Tavily APIê°€ ì‹¤ì œ URLì„ ì°¾ì•„ì•¼ í•˜ëŠ”ë°, í”„ë¡ íŠ¸ì—”ë“œì—ëŠ” Google ê²€ìƒ‰ ë§í¬ë§Œ í‘œì‹œ

#### ğŸ” ì¶”ë¡  ê³¼ì •

**1ë‹¨ê³„: ë¬¸ì œ ë²”ìœ„ íŒŒì•…**
```
ì§ˆë¬¸: ë¬¸ì œê°€ ì–´ë””ì„œ ë°œìƒí•˜ëŠ”ê°€?
- í”„ë¡ íŠ¸ì—”ë“œ ë Œë”ë§ ë¬¸ì œ?
- ë°±ì—”ë“œ API ì‘ë‹µ ë¬¸ì œ?
- Tavily API ìì²´ ë¬¸ì œ?
- DB ì €ì¥/ì¡°íšŒ ë¬¸ì œ?
```

**2ë‹¨ê³„: Tavily API ì§ì ‘ í…ŒìŠ¤íŠ¸**
```python
# í„°ë¯¸ë„ì—ì„œ ì§ì ‘ í…ŒìŠ¤íŠ¸
from app.services.tavily_search import search_source_by_type
result = search_source_by_type('ê¸ˆìœµíˆ¬ìí˜‘íšŒ 2023ë…„ ì‚¬ëª¨í€ë“œ í˜„í™©ë³´ê³ ì„œ', 'ë³´ê³ ì„œ')
print(result)
# ê²°ê³¼: {'found': True, 'url': 'https://www.kofia.or.kr/...'}
```
â†’ **ê²°ë¡ : Tavily API ì •ìƒ ì‘ë™**

**3ë‹¨ê³„: verify_critical_sources í•¨ìˆ˜ í…ŒìŠ¤íŠ¸**
```python
# Mock ë°ì´í„°ë¡œ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
mock_data = {
    'hidden_premises': [
        {'source': 'ê¸ˆìœµíˆ¬ìí˜‘íšŒ 2023ë…„ ì‚¬ëª¨í€ë“œ í˜„í™©ë³´ê³ ì„œ', 'source_url': None}
    ]
}
result = await verify_critical_sources(mock_data)
print(result['hidden_premises'][0]['source_url'])
# ê²°ê³¼: 'https://www.kofia.or.kr/...' (ì‹¤ì œ URL)
```
â†’ **ê²°ë¡ : verify_critical_sources í•¨ìˆ˜ë„ ì •ìƒ ì‘ë™**

**4ë‹¨ê³„: API ì‘ë‹µ ë°ì´í„° í™•ì¸**
```bash
curl -s "http://localhost:8000/api/result/{id}" | python -c "
import sys, json
data = json.load(sys.stdin)
hp = data['data']['critical_analysis']['hidden_premises']
print(hp[0]['source_url'])
"
# ê²°ê³¼: None
```
â†’ **ê²°ë¡ : API ì‘ë‹µì— source_urlì´ ì—†ìŒ! ì–´ë”˜ê°€ì—ì„œ URLì´ ì‚¬ë¼ì§**

**5ë‹¨ê³„: ë°ì´í„° íë¦„ ì¶”ì **
```
1. Claude ë¶„ì„ â†’ source_url: null ìƒì„±
2. verify_critical_sources í˜¸ì¶œ â†’ source_url ì¶”ê°€ë˜ì–´ì•¼ í•¨
3. DB ì €ì¥ â†’ source_url í¬í•¨í•˜ì—¬ ì €ì¥
4. API ì¡°íšŒ â†’ source_url ë°˜í™˜
5. í”„ë¡ íŠ¸ì—”ë“œ ë Œë”ë§ â†’ source_urlë¡œ ë§í¬ ìƒì„±
```

**6ë‹¨ê³„: í•µì‹¬ ë°œê²¬!**
```
ì„œë²„ ë¡œê·¸ì— verify_critical_sources ê´€ë ¨ ë¡œê·¸ê°€ ì „í˜€ ì—†ìŒ
â†’ í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ì§€ ì•Šê±°ë‚˜, ë¡œê·¸ê°€ ì¶œë ¥ë˜ì§€ ì•ŠìŒ
â†’ printë¬¸ì— flush=True ì¶”ê°€ í›„ ì¬í…ŒìŠ¤íŠ¸
```

**7ë‹¨ê³„: ê·¼ë³¸ ì›ì¸ ë°œê²¬**
```
ê¸°ì¡´ ë¶„ì„ ë°ì´í„° ì¡°íšŒ ì‹œ verify_critical_sourcesê°€ í˜¸ì¶œë˜ì§€ ì•ŠìŒ!

- ë¹„íŒì  ë¶„ì„ ì‹œ: verify_critical_sources í˜¸ì¶œë¨ âœ“
- ê²°ê³¼ ì¡°íšŒ ì‹œ: verify_critical_sources í˜¸ì¶œ ì•ˆ ë¨ âœ—

ë¬¸ì œ: ì´ë¯¸ ì €ì¥ëœ ê¸°ì¡´ ë°ì´í„°ëŠ” URLì´ ì—†ëŠ” ìƒíƒœë¡œ ì €ì¥ë¨
â†’ ì¡°íšŒí•  ë•Œ ê²€ì¦ ë¡œì§ì´ ì—†ì–´ì„œ URL ì—†ì´ ê·¸ëŒ€ë¡œ ë°˜í™˜
```

#### ğŸ¯ ë³¸ì§ˆì ì¸ ë¬¸ì œ

**"ê¸°ì¡´ ë°ì´í„°ì— ëŒ€í•œ ë§ˆì´ê·¸ë ˆì´ì…˜/ì—…ë°ì´íŠ¸ ë¡œì§ ë¶€ì¬"**

```
ìƒˆë¡œìš´ ê¸°ëŠ¥(Tavily URL ê²€ì¦)ì„ ì¶”ê°€í–ˆì§€ë§Œ:
1. ìƒˆ ë¶„ì„ì—ë§Œ ì ìš©ë¨
2. ê¸°ì¡´ì— ì €ì¥ëœ ë¶„ì„ ê²°ê³¼ëŠ” URLì´ ì—†ëŠ” ìƒíƒœë¡œ ë‚¨ì•„ìˆìŒ
3. ì¡°íšŒ ì‹œ ê¸°ì¡´ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ë¡œì§ì´ ì—†ìŒ
```

#### âœ… í•´ê²°ì±…

**get_result ì—”ë“œí¬ì¸íŠ¸ì— ì¡°íšŒ ì‹œ URL ê²€ì¦ ë¡œì§ ì¶”ê°€:**

```python
@router.get("/result/{analysis_id}")
async def get_result(analysis_id: str):
    result = await get_analysis_by_id(analysis_id)

    # ê¸°ì¡´ ë°ì´í„°ì— URLì´ ì—†ìœ¼ë©´ Tavilyë¡œ ê²€ì¦ í›„ ì—…ë°ì´íŠ¸
    ca = result.get('critical_analysis')
    if ca:
        needs_update = False
        for hp in ca.get('hidden_premises', []):
            if isinstance(hp, dict):
                url = hp.get('source_url')
                # URLì´ ì—†ê±°ë‚˜, Google ê²€ìƒ‰ URLì´ê±°ë‚˜, 'null' ë¬¸ìì—´ì¸ ê²½ìš°
                if not url or 'google.com/search' in str(url) or str(url).lower() in ['null', 'none', '']:
                    needs_update = True
                    break

        if needs_update:
            updated_ca = await verify_critical_sources(ca)
            await update_analysis(analysis_id, {"critical_analysis": updated_ca})
            result['critical_analysis'] = updated_ca

    # ... ê²°ê³¼ ë°˜í™˜
```

**ì¶”ê°€ ìˆ˜ì • ì‚¬í•­:**
```python
# 1. tavily_search.py - dotenv ë¡œë”© ì¶”ê°€
from dotenv import load_dotenv
load_dotenv()  # ëª¨ë“ˆ ë¡œë“œ ì‹œ .env ì½ê¸°

# 2. claude.py - needs_url_search í—¬í¼ í•¨ìˆ˜
def needs_url_search(url_value):
    if not url_value:
        return True
    if isinstance(url_value, str):
        url_lower = url_value.lower().strip()
        if url_lower in ['null', 'none', '', '-']:
            return True
        if 'google.com/search' in url_lower:
            return True
    return False

# 3. printë¬¸ì— flush=True ì¶”ê°€ (ë””ë²„ê¹…ìš©)
print(f"[GET] critical_analysis URL ì—†ìŒ...", flush=True)
```

#### ğŸ“š í•µì‹¬ êµí›ˆ

1. **ìƒˆ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ê³ ë ¤**
   - ìƒˆ í•„ë“œ ì¶”ê°€ â†’ ê¸°ì¡´ ë°ì´í„°ëŠ” í•´ë‹¹ í•„ë“œê°€ ì—†ìŒ
   - ì¡°íšŒ ì‹œ ìë™ ì—…ë°ì´íŠ¸ ë¡œì§ í•„ìš”

2. **ë°ì´í„° íë¦„ì„ ë‹¨ê³„ë³„ë¡œ ì¶”ì **
   ```
   ì…ë ¥ â†’ ì²˜ë¦¬1 â†’ ì²˜ë¦¬2 â†’ ì €ì¥ â†’ ì¡°íšŒ â†’ ì¶œë ¥
   ê° ë‹¨ê³„ì—ì„œ ë°ì´í„°ê°€ ì–´ë–»ê²Œ ë³€í•˜ëŠ”ì§€ í™•ì¸
   ```

3. **"ì‘ë™í•¨"ê³¼ "í•­ìƒ ì‘ë™í•¨"ì€ ë‹¤ë¦„**
   ```
   - ìƒˆ ë¶„ì„: ì‘ë™ âœ“
   - ê¸°ì¡´ ë°ì´í„° ì¡°íšŒ: ì‘ë™ ì•ˆ í•¨ âœ—
   â†’ ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ í•„ìš”
   ```

4. **ë¡œê·¸ê°€ ì•ˆ ë³´ì´ë©´ flush í™•ì¸**
   ```python
   # Windowsì—ì„œ íŠ¹íˆ ì¤‘ìš”
   print("ë¡œê·¸", flush=True)
   ```

5. **null ê°’ì˜ ë‹¤ì–‘í•œ í˜•íƒœ ì²˜ë¦¬**
   ```python
   # None, 'null', 'None', '', '-', 'google.com/search' URL ë“±
   # ëª¨ë‘ "URLì´ ì—†ìŒ"ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•¨
   ```

#### ğŸ›  ë””ë²„ê¹… ì²´í¬ë¦¬ìŠ¤íŠ¸ (ì¶œì²˜ URL ë¬¸ì œ)

```
â–¡ Tavily API í‚¤ê°€ .envì— ìˆëŠ”ê°€?
â–¡ tavily_search.pyì—ì„œ load_dotenv() í˜¸ì¶œí•˜ëŠ”ê°€?
â–¡ verify_critical_sourcesê°€ í˜¸ì¶œë˜ëŠ”ê°€? (ë¡œê·¸ í™•ì¸)
â–¡ Claudeê°€ source_urlì— ì–´ë–¤ ê°’ì„ ë„£ëŠ”ê°€? (null, 'null', '' ë“±)
â–¡ DBì— ì €ì¥ëœ ë°ì´í„°ì— source_urlì´ ìˆëŠ”ê°€?
â–¡ ì¡°íšŒ ì‹œ ê¸°ì¡´ ë°ì´í„° ì—…ë°ì´íŠ¸ ë¡œì§ì´ ìˆëŠ”ê°€?
â–¡ í”„ë¡ íŠ¸ì—”ë“œ SourceLink ì»´í¬ë„ŒíŠ¸ê°€ URLì„ ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬í•˜ëŠ”ê°€?
```

---

### Case 2: Pydantic validation ì—ëŸ¬ - None ê°’ ì²˜ë¦¬ (2025.01.09)

#### ğŸ“‹ ì¦ìƒ
```
6 validation errors for AnalysisResult
- quotes.0.Quote.speaker Input should be a valid string, input_value=None
- quotes.0.str Input should be a valid string, input_value={'text': 'ì‹¤ì œë¡œ ìˆ˜...ìš”', 'speaker': None}
- source_tracking.0.source_title Input should be a valid string, input_value=None
```

#### ğŸ” ì›ì¸
Claude APIê°€ JSON ì‘ë‹µì—ì„œ ì¼ë¶€ í•„ë“œë¥¼ `null`ë¡œ ë°˜í™˜í•˜ëŠ”ë°, Pydantic ìŠ¤í‚¤ë§ˆì—ì„œ í•´ë‹¹ í•„ë“œê°€ `str` (í•„ìˆ˜)ë¡œ ì •ì˜ë˜ì–´ ìˆì–´ validation ì—ëŸ¬ ë°œìƒ

```python
# âŒ ë¬¸ì œê°€ ë˜ëŠ” ìŠ¤í‚¤ë§ˆ ì •ì˜
class Quote(BaseModel):
    text: str = Field(..., description="ì¸ìš© ì›ë¬¸")
    speaker: str = Field(..., description="ë°œì–¸ì")  # None í—ˆìš© ì•ˆ í•¨!

class SourceTracking(BaseModel):
    quote: str = Field(..., description="ì¸ìš© ë¬¸ì¥")
    source_title: str = Field(..., description="ì¶œì²˜ ì œëª©")  # None í—ˆìš© ì•ˆ í•¨!
```

#### âœ… í•´ê²°ì±…
`backend/app/models/schemas.py`ì—ì„œ Noneì´ ì˜¬ ìˆ˜ ìˆëŠ” í•„ë“œë¥¼ `Optional`ë¡œ ë³€ê²½:

```python
# âœ… ì˜¬ë°”ë¥¸ ìŠ¤í‚¤ë§ˆ ì •ì˜
class Quote(BaseModel):
    text: str = Field(..., description="ì¸ìš© ì›ë¬¸")
    speaker: Optional[str] = Field(None, description="ë°œì–¸ì")  # None í—ˆìš©

class SourceTracking(BaseModel):
    quote: Optional[str] = Field(None, description="ì¸ìš© ë¬¸ì¥")
    source_title: Optional[str] = Field(None, description="ì¶œì²˜ ì œëª©")
    source_type: Optional[str] = Field(None, description="ì¶œì²˜ ìœ í˜•")
    reliability: Optional[int] = Field(1, description="ì‹ ë¢°ë„")
```

#### ğŸ“ Optionalë¡œ ë³€ê²½í•´ì•¼ í•  í•„ë“œ ëª©ë¡
- `Quote.speaker`
- `SourceTracking`: quote, source_title, source_type, reliability
- `HiddenPremise`: premise, why_problem, source
- `RealisticContradiction`: strategy, difficulty_reason, evidence_data, source
- `SourceBasedContradiction`: ëª¨ë“  í•„ë“œ
- `HookingPoint`: point, level
- `ContentDirectionStep`: stage, example_script, intention
- `ProblemSolutionItem`: problem, human_difficulty, automation_solution, implementation
- `LifeExpansionExample`: area, principle, application
- `AutomationInsight`: video_type, core_insight

#### ğŸ“š í•µì‹¬ êµí›ˆ
1. **Claude API ì‘ë‹µì€ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥** - í”„ë¡¬í”„íŠ¸ì—ì„œ í•„ìˆ˜ë¼ê³  í•´ë„ nullì´ ì˜¬ ìˆ˜ ìˆìŒ
2. **ë°©ì–´ì  ìŠ¤í‚¤ë§ˆ ì„¤ê³„** - ì™¸ë¶€ API ì‘ë‹µì„ ë°›ëŠ” í•„ë“œëŠ” ì›¬ë§Œí•˜ë©´ Optionalë¡œ ì •ì˜
3. **ì—ëŸ¬ ë©”ì‹œì§€ ì •í™•íˆ ì½ê¸°** - `input_value=None`ì´ íŒíŠ¸

---

### Case 3: Claude ì‘ë‹µì—ì„œ ìƒˆ í•„ë“œê°€ íŒŒì‹±ë˜ì§€ ì•ŠëŠ” ë¬¸ì œ (2025.01.09)

#### ğŸ“‹ ì¦ìƒ
- `perspectives.py` í”„ë¡¬í”„íŠ¸ì— `automation_insight` ì¶œë ¥ êµ¬ì¡° ì¶”ê°€
- í•˜ì§€ë§Œ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ìƒˆ í˜•ì‹(í…Œì´ë¸”, í•µì‹¬ ì¸ì‚¬ì´íŠ¸)ì´ í‘œì‹œ ì•ˆ ë¨
- ì˜ˆì „ `perspective_insights` ë¦¬ìŠ¤íŠ¸ í˜•ì‹ë§Œ í‘œì‹œë¨

#### ğŸ” ì¶”ë¡  ê³¼ì •

**1ë‹¨ê³„: í”„ë¡¬í”„íŠ¸ í™•ì¸**
```python
# perspectives.py - í”„ë¡¬í”„íŠ¸ì— automation_insight êµ¬ì¡° ìˆìŒ âœ“
"automation_insight": {{
    "video_type": "...",
    "problem_solution_table": [...],
    "core_insight": "...",
    "life_expansion": {{...}}
}}
```

**2ë‹¨ê³„: ë°±ì—”ë“œ ë¡œê·¸ í™•ì¸**
```
[DEBUG] verify_critical_sources í›„ critical_result keys:
dict_keys(['perspective', 'perspective_name', 'hidden_premises',
'realistic_contradictions', 'source_based_contradictions', 'hooking_points',
'content_direction', 'perspective_insights', 'contradiction_analyses'])
```
â†’ **automation_insightê°€ ì—†ìŒ!**

**3ë‹¨ê³„: ê·¼ë³¸ ì›ì¸ ë°œê²¬**
`claude.py`ì˜ `analyze_critical_v2` í•¨ìˆ˜ì—ì„œ Claude ì‘ë‹µì„ ì •ê·œí™”í•  ë•Œ `automation_insight` í•„ë“œë¥¼ ì¶”ì¶œí•˜ì§€ ì•ŠìŒ:

```python
# âŒ ë¬¸ì œ ì½”ë“œ - automation_insight ëˆ„ë½
normalized_result = {
    "perspective": perspective_id,
    "perspective_name": perspective.name,
    "hidden_premises": analysis_result.get("hidden_premises", []),
    "realistic_contradictions": analysis_result.get("realistic_contradictions", []),
    # ... ë‹¤ë¥¸ í•„ë“œë“¤
    # automation_insight ì—†ìŒ!
}
```

#### âœ… í•´ê²°ì±…

`backend/app/services/claude.py`ì˜ `normalized_result`ì— ëˆ„ë½ëœ í•„ë“œ ì¶”ê°€:

```python
# âœ… ìˆ˜ì •ëœ ì½”ë“œ
normalized_result = {
    "perspective": perspective_id,
    "perspective_name": perspective.name,
    "hidden_premises": analysis_result.get("hidden_premises", []),
    "realistic_contradictions": analysis_result.get("realistic_contradictions", []),
    "source_based_contradictions": analysis_result.get("source_based_contradictions", []),
    "hooking_points": analysis_result.get("hooking_points", []),
    "content_direction": analysis_result.get("content_direction", []),
    "perspective_insights": analysis_result.get("perspective_insights", []),
    "auto_trading_connection": analysis_result.get("auto_trading_connection", []),  # ì¶”ê°€!
    "automation_insight": analysis_result.get("automation_insight"),  # ì¶”ê°€!
    "contradiction_analyses": [],
}

# ë””ë²„ê·¸ ë¡œê·¸ ì¶”ê°€
print(f"[DEBUG] Claude ì›ë³¸ ì‘ë‹µ keys: {analysis_result.keys()}")
print(f"[DEBUG] Claude ì‘ë‹µì—ì„œ automation_insight ì¡´ì¬: {'automation_insight' in analysis_result}")
```

#### ğŸ“š í•µì‹¬ êµí›ˆ

1. **í”„ë¡¬í”„íŠ¸ ìˆ˜ì • â‰  ìë™ ë°˜ì˜**
   - í”„ë¡¬í”„íŠ¸ì— ìƒˆ ì¶œë ¥ êµ¬ì¡°ë¥¼ ì¶”ê°€í•´ë„, ë°±ì—”ë“œ íŒŒì‹± ì½”ë“œë¥¼ ìˆ˜ì •í•´ì•¼ í•¨

2. **ë°ì´í„° íë¦„ ì „ì²´ í™•ì¸**
   ```
   í”„ë¡¬í”„íŠ¸ â†’ Claude ì‘ë‹µ â†’ íŒŒì‹±(normalized_result) â†’ DB ì €ì¥ â†’ API ì‘ë‹µ â†’ í”„ë¡ íŠ¸ì—”ë“œ
   ```
   ê° ë‹¨ê³„ì—ì„œ ë°ì´í„°ê°€ ì „ë‹¬ë˜ëŠ”ì§€ í™•ì¸

3. **ë””ë²„ê·¸ ë¡œê·¸ì˜ ì¤‘ìš”ì„±**
   - `analysis_result.keys()` ì¶œë ¥ìœ¼ë¡œ Claudeê°€ ì‹¤ì œë¡œ ë­˜ ë°˜í™˜í•˜ëŠ”ì§€ í™•ì¸
   - ì—†ìœ¼ë©´ Claudeê°€ í”„ë¡¬í”„íŠ¸ë¥¼ ì•ˆ ë”°ë¥´ëŠ” ê²ƒ, ìˆëŠ”ë° ì•ˆ ë³´ì´ë©´ íŒŒì‹± ë¬¸ì œ

4. **ì„œë²„ ë¦¬ë¡œë“œ íƒ€ì´ë° ì£¼ì˜**
   - ì½”ë“œ ìˆ˜ì • í›„ ë¶„ì„ ì‹¤í–‰ ì‹œ, ì„œë²„ê°€ ë¦¬ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
   - ë¦¬ë¡œë“œ ì „ì— ë¶„ì„í•˜ë©´ ì˜ˆì „ ì½”ë“œë¡œ ì‹¤í–‰ë¨

#### ğŸ›  ìƒˆ í•„ë“œ ì¶”ê°€ ì‹œ ì²´í¬ë¦¬ìŠ¤íŠ¸

```
â–¡ perspectives.py í”„ë¡¬í”„íŠ¸ì— ì¶œë ¥ êµ¬ì¡° ì¶”ê°€
â–¡ schemas.pyì— Pydantic ëª¨ë¸ ì¶”ê°€/ìˆ˜ì •
â–¡ claude.py normalized_resultì— í•„ë“œ ì¶”ê°€
â–¡ youtube.pyì—ì„œ í•´ë‹¹ í•„ë“œ ì‚¬ìš©í•˜ëŠ” ê³³ í™•ì¸
â–¡ api.tsì— TypeScript ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€
â–¡ ResultCard.tsxì— ë Œë”ë§ ì»´í¬ë„ŒíŠ¸ ì¶”ê°€
â–¡ ì„œë²„ ì¬ì‹œì‘ í›„ í…ŒìŠ¤íŠ¸
```

---

*ì´ ê°€ì´ë“œëŠ” YouTube Analyzer í”„ë¡œì íŠ¸ (2025.01.07~09) ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.*
