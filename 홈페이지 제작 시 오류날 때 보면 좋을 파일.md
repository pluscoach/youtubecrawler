# 🚀 웹사이트 개발 가이드

## 이 가이드는?
YouTube Analyzer 프로젝트를 만들면서 겪은 경험을 바탕으로 작성한 **실전 가이드**입니다.
새로운 웹사이트를 만들 때 참고하세요.

---

## 📋 작업 순서 (권장)

### 1단계: 기획 및 설계 (먼저!)
```
□ 서비스 목적 정의 (누가, 왜 쓰는지)
□ 핵심 기능 목록 작성
□ 기술 스택 결정
□ 폴더 구조 설계
□ API 설계 (엔드포인트 목록)
□ DB 스키마 설계
```

### 2단계: 외부 서비스 설정 (API 키 먼저 확보!)
```
□ 필요한 외부 서비스 목록 작성
□ 각 서비스 계정 생성 및 API 키 발급
□ API 키 테스트 (각각 개별로!)
□ .env 파일에 키 정리
```

### 3단계: 백엔드 개발
```
□ 프로젝트 폴더 생성
□ 기본 서버 실행 확인
□ DB 연결 테스트
□ API 엔드포인트 하나씩 구현 및 테스트
```

### 4단계: 프론트엔드 개발
```
□ 기본 페이지 레이아웃
□ API 연동
□ 에러 처리 및 로딩 상태
□ UI/UX 다듬기
```

### 5단계: 통합 테스트 및 배포
```
□ 전체 플로우 테스트
□ 에러 케이스 테스트
□ 배포 (Vercel, Railway 등)
□ 프로덕션 환경 테스트
```

---

## 🔑 API 키 관리 체크리스트

### 발급 시 확인사항
| 서비스 | 필요한 키 | 형식 예시 |
|--------|----------|----------|
| **Anthropic** | API Key | `sk-ant-api03-xxx...` |
| **YouTube** | Data API Key | `AIzaSy...` |
| **Supabase** | URL + service_role Key | `https://xxx.supabase.co` + `eyJhbG...` (JWT) |
| **OpenAI** | API Key | `sk-xxx...` |
| **Stripe** | Secret Key | `sk_live_xxx...` 또는 `sk_test_xxx...` |

### ⚠️ Supabase 키 주의사항 (중요!)
```
❌ 잘못된 키: sb_publishable_xxx (프론트엔드용)
❌ 잘못된 키: sb_secret_xxx (새 형식, 호환 안 될 수 있음)
✅ 올바른 키: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... (Legacy service_role)

찾는 방법:
Settings → API Keys → "Legacy anon, service_role API keys" 탭 → service_role 복사
```

### API 키 개별 테스트 방법

**Anthropic:**
```python
python -c "
import anthropic
client = anthropic.Anthropic(api_key='너의_키')
response = client.messages.create(
    model='claude-sonnet-4-20250514',
    max_tokens=100,
    messages=[{'role': 'user', 'content': 'Hello'}]
)
print('성공:', response.content[0].text)
"
```

**Supabase:**
```python
python -c "
from supabase import create_client
client = create_client('너의_URL', '너의_service_role_키')
print('연결 성공')
result = client.table('테이블명').select('*').limit(1).execute()
print(result)
"
```

**YouTube:**
```bash
curl "https://www.googleapis.com/youtube/v3/videos?part=snippet&id=dQw4w9WgXcQ&key=너의_키"
```

---

## 🐛 자주 발생하는 문제와 해결법

### 1. "Invalid API key" 에러

**원인 체크리스트:**
```
□ .env 파일에 키가 제대로 들어갔는지 확인
□ 키 앞뒤에 공백이나 따옴표가 없는지 확인
□ 키가 한 줄로 되어 있는지 확인 (줄바꿈 X)
□ 올바른 키 종류인지 확인 (public vs secret)
□ 서버 재시작했는지 확인 (@lru_cache 캐싱 문제)
```

**해결 단계:**
```
1. 터미널에서 직접 API 테스트 (위의 테스트 코드 사용)
2. 성공하면 → 코드가 키를 못 읽어오는 문제
3. 실패하면 → 키 자체가 잘못됨, 재발급 필요
```

### 2. "Object of type X is not JSON serializable" 에러

**원인:** 
- 라이브러리가 반환한 객체를 직접 JSON으로 변환하려고 할 때

**해결:**
```python
# ❌ 잘못된 방법
return transcript_data  # 객체 그대로 반환

# ✅ 올바른 방법
return ' '.join([item.text for item in transcript_data])  # 문자열로 변환
```

### 3. 자막 추출 에러 (YouTube)

**"No transcripts were found for language codes: ('en',)"**
```python
# ❌ 영어만 찾음
transcript = YouTubeTranscriptApi.get_transcript(video_id, languages=['en'])

# ✅ 한국어 우선, 없으면 영어
transcript = YouTubeTranscriptApi.get_transcript(video_id, languages=['ko', 'en'])
```

### 4. CORS 에러

**증상:** 프론트엔드에서 백엔드 API 호출 시 에러

**해결 (FastAPI):**
```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],  # 프론트엔드 주소
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### 5. 환경변수 캐싱 문제

**증상:** .env 수정했는데 적용 안 됨

**원인:** Python의 `@lru_cache()` 데코레이터

**해결:**
```bash
# 1. 캐시 폴더 삭제
rm -rf __pycache__
rm -rf app/__pycache__
rm -rf app/services/__pycache__

# 2. 서버 완전히 종료 후 재시작
# Ctrl+C로 종료
uvicorn app.main:app --reload
```

### 6. 라이브러리 버전 충돌

**증상:** `HTTPTransport.__init__() got an unexpected keyword argument`

**해결:**
```bash
pip install httpx==0.27.0 anthropic==0.18.1 --force-reinstall
```

### 7. DNS/URL 에러

**증상:** `getaddrinfo failed`

**원인:** URL 오타

**해결:**
```
1. 외부 서비스 대시보드에서 정확한 URL 복사
2. .env 파일과 비교
3. 글자 하나하나 확인 (특히 비슷한 글자: l/1, o/0, q/g)
```

### 8. 프론트엔드-백엔드 포트 불일치

**증상:** 프론트엔드에서 API 호출 시 연결 실패

**원인:** 프론트엔드의 API URL과 실제 백엔드 서버 포트가 다름

**해결:**
```
1. 백엔드 서버가 실행 중인 포트 확인 (예: 8000)
2. 프론트엔드 API 설정 파일 확인
   - 파일: frontend/src/lib/api.ts
   - 확인할 부분: const API_URL = ... 'http://localhost:XXXX'
3. 포트 번호 일치시키기
```

**예시 (2025.01.07 발생):**
```typescript
// ❌ 잘못됨 - 백엔드가 8000에서 실행 중인데 8001로 설정
const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8001';

// ✅ 올바름
const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';
```

### 9. TypeScript 주석과 코드가 같은 줄에 붙어있는 문법 오류

**증상:** `Failed to compile` - `Expression expected` Syntax Error

**원인:** 한글 주석이 깨지면서 주석과 export/코드가 같은 줄에 붙어버림

**해결:**
```
1. 오류 메시지에서 파일명과 줄 번호 확인
2. 해당 줄에서 주석(//)과 코드가 같은 줄에 있는지 확인
3. 주석과 코드 사이에 줄바꿈 추가
```

**예시 (2025.01.07 발생):**
```typescript
// ❌ 잘못됨 - 주석과 export가 같은 줄에 붙어있음
// B-roll ?�워??export interface BRollKeyword {

// ✅ 올바름 - 줄바꿈으로 분리
// B-roll 키워드
export interface BRollKeyword {
```

**이 오류가 발생하기 쉬운 상황:**
- 파일 인코딩 문제로 한글 주석이 깨질 때
- Git merge 과정에서 충돌 해결 시
- 복사/붙여넣기 과정에서 줄바꿈이 사라질 때

**발생 파일:** `frontend/src/lib/api.ts` (여러 인터페이스 정의 부분)

### 10. youtube-transcript-api 라이브러리 API 변경

**증상:** 자막 추출 시 `AttributeError` 또는 기존 메서드가 동작 안 함

**원인:** youtube-transcript-api 라이브러리가 업데이트되면서 API 사용 방식이 변경됨

**해결:**
```python
# ❌ 구버전 방식 (동작 안 함)
from youtube_transcript_api import YouTubeTranscriptApi
transcript = YouTubeTranscriptApi.get_transcript(video_id, languages=['ko', 'en'])

# ✅ 신버전 방식 (인스턴스 생성 필요)
from youtube_transcript_api import YouTubeTranscriptApi
api = YouTubeTranscriptApi()
transcript_list = api.list(video_id)  # 자막 목록 조회
transcript_data = transcript.fetch()   # 특정 자막 가져오기
```

**발생 파일:** `backend/app/services/transcript.py`

### 11. 자막 언어 우선순위 및 폴백 처리

**증상:** 특정 영상에서 "자막을 찾을 수 없습니다" 에러

**원인:** 한국어/영어 자막이 없거나, 자동생성 자막만 있는 경우 처리 안 됨

**해결:**
```python
# 자막 우선순위 폴백 로직
# 1. 한국어 수동 자막
# 2. 한국어 자동생성 자막
# 3. 영어 수동 자막
# 4. 영어 자동생성 자막
# 5. 아무 자막이나 (마지막 폴백)

for transcript in transcripts:
    if transcript.language_code == 'ko' and not transcript.is_generated:
        target_transcript = transcript
        break
# ... 이후 폴백 로직 계속
```

**핵심:** `is_generated` 속성으로 수동/자동 자막 구분 가능

**발생 파일:** `backend/app/services/transcript.py`

### 12. 환경변수 로딩 타이밍 문제 (Supabase 등)

**증상:** 환경변수가 None으로 읽히거나, "URL and Key must be set" 에러

**원인:** 모듈 로드 시점에 `get_settings()`를 전역에서 호출하면 환경변수가 아직 로드 안 됨

**해결:**
```python
# ❌ 잘못됨 - 모듈 로드 시점에 호출
settings = get_settings()  # 전역 변수

def get_supabase():
    if not settings.supabase_url:  # 이미 None으로 고정됨
        raise ValueError(...)

# ✅ 올바름 - 함수 호출 시점에 로드
def get_supabase():
    settings = get_settings()  # 함수 내부에서 호출
    if not settings.supabase_url:
        raise ValueError(...)
```

**발생 파일:** `backend/app/database.py`

### 13. requirements.txt 버전 충돌

**증상:** `pip install` 시 의존성 충돌, 또는 런타임에 `unexpected keyword argument` 에러

**원인:** 라이브러리 간 버전 호환성 문제 (예: httpx, anthropic)

**해결:**
```
# ❌ 고정 버전 (충돌 가능)
httpx==0.24.0
anthropic==0.18.1

# ✅ 유연한 버전 범위
httpx>=0.27.0
anthropic>=0.18.1
```

**추가 해결법:**
```bash
# 강제 재설치
pip install httpx==0.27.0 anthropic==0.18.1 --force-reinstall
```

**발생 파일:** `backend/requirements.txt`

### 14. 디버그 print문 정리

**증상:** 콘솔에 불필요한 DEBUG 메시지 출력, 프로덕션 로그 오염

**원인:** 트러블슈팅 중 추가한 print문을 제거 안 함

**해결:**
```python
# ❌ 제거해야 할 코드
print(f"[DEBUG] API 응답: {response}")
print(f"[DEBUG] 설정값: {settings}")

# ✅ 필요하면 logging 모듈 사용
import logging
logger = logging.getLogger(__name__)
logger.debug(f"API 응답: {response}")  # 프로덕션에서는 출력 안 됨
```

**체크할 파일들:**
- `backend/app/services/transcript.py`
- `backend/app/services/claude.py`
- `backend/app/routers/youtube.py`
- `backend/app/config.py`
- `backend/app/database.py`

---

## 📁 권장 폴더 구조

```
프로젝트명/
├── frontend/                # Next.js 프론트엔드
│   ├── src/
│   │   ├── app/            # 페이지들
│   │   ├── components/     # 컴포넌트들
│   │   └── lib/            # 유틸리티 (API 호출 등)
│   ├── package.json
│   └── .env.local          # 프론트엔드 환경변수
│
├── backend/                 # FastAPI 백엔드
│   ├── app/
│   │   ├── main.py         # 앱 초기화
│   │   ├── config.py       # 설정
│   │   ├── database.py     # DB 연결
│   │   ├── routers/        # API 라우터들
│   │   ├── services/       # 비즈니스 로직
│   │   └── models/         # 데이터 모델
│   ├── requirements.txt
│   ├── .env                # 백엔드 환경변수
│   └── Dockerfile
│
├── plans/                   # 문서
│   ├── CLAUDE.md           # 프로젝트 개요
│   ├── ARCHITECTURE.md     # 시스템 구조
│   └── PROGRESS.md         # 진행 상황
│
├── .gitignore
├── docker-compose.yml
└── README.md
```

---

## 🔧 디버깅 팁

### 1. 단계별로 확인하기
```
문제가 생기면 전체 흐름을 단계별로 나눠서 확인:

1단계: 입력이 제대로 들어오는지?
2단계: 외부 API 호출이 성공하는지?
3단계: 데이터 변환이 제대로 되는지?
4단계: DB 저장이 성공하는지?
5단계: 응답이 프론트엔드에 제대로 전달되는지?
```

### 2. 디버그 로그 추가하기
```python
print(f"[DEBUG] 1. 입력값: {input_data}")
print(f"[DEBUG] 2. API 응답: {response[:100]}...")
print(f"[DEBUG] 3. 변환 결과: {type(result)}")
```

### 3. 에러 메시지 정확히 읽기
```
에러 메시지가 어디서 발생했는지 확인:
- 프론트엔드? 백엔드? 외부 API?
- 어떤 함수/파일에서?
- 정확한 에러 타입은?
```

---

## ✅ 배포 전 체크리스트

```
□ 모든 API 키가 프로덕션용인지 확인
□ .env 파일이 .gitignore에 있는지 확인
□ 디버그 코드/print문 제거
□ 에러 핸들링이 제대로 되어 있는지 확인
□ 환경변수가 배포 플랫폼에 설정되어 있는지 확인
□ CORS 설정이 프로덕션 도메인으로 되어 있는지 확인
```

---

## 📚 참고 링크

- [FastAPI 공식 문서](https://fastapi.tiangolo.com/)
- [Next.js 공식 문서](https://nextjs.org/docs)
- [Supabase 공식 문서](https://supabase.com/docs)
- [Anthropic API 문서](https://docs.anthropic.com/)
- [Vercel 배포 가이드](https://vercel.com/docs)
- [Railway 배포 가이드](https://docs.railway.app/)

---

## 💡 마지막 팁

1. **API 키는 항상 개별 테스트** - 통합하기 전에 각각 작동하는지 확인
2. **에러 메시지를 정확히 읽기** - 어디서 발생했는지가 핵심
3. **캐시 문제 의심하기** - 안 되면 캐시 삭제 + 서버 재시작
4. **한 번에 하나씩** - 여러 개 동시에 바꾸면 뭐가 문제인지 모름
5. **문서화하기** - 해결한 문제는 기록해두기

---

*이 가이드는 YouTube Analyzer 프로젝트 (2026.01.07) 경험을 바탕으로 작성되었습니다.*
